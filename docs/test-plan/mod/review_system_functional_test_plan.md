# 審核系統模組功能測試計劃

## 文件資訊
- **模組名稱**: ReviewSystemModule (審核與簽核系統模組)
- **文件版本**: v1.0
- **建立日期**: 2025/05/31
- **最後更新**: 2025/05/31
- **測試負責人**: QA 團隊
- **狀態**: 草稿
- **參考文件**: 
  - [`docs/mod/review_system_mdd.md`](../../mod/review_system_mdd.md) - 模組設計文件
  - [`docs/test-plan/overall_test_strategy.md`](../overall_test_strategy.md) - 總體測試策略
  - [`docs/user_flows/core_user_flows.md`](../../user_flows/core_user_flows.md) - 核心用戶流程
  - [`docs/mvp_definition.md`](../../mvp_definition.md) - MVP 定義

---

## 1. 引言

### 1.1 目的
本文件定義審核與簽核系統模組的詳細功能測試計劃，確保：
- 審核任務管理功能完整
- 意見註記系統正確運作
- 差異檢查機制有效
- 數位簽核功能安全可靠
- 審核歷史追蹤完整

### 1.2 範圍
本測試計劃涵蓋：
- **審核管理測試**: 任務分派、狀態追蹤、期限管理
- **意見註記測試**: 文字註記、標記高亮、附件管理
- **差異檢查測試**: 一致性檢查、版本比較、異常檢測
- **簽核功能測試**: 數位簽核、權限驗證、記錄管理
- **整合測試**: 與工作流程、通知模組的整合

### 1.3 測試目標
- 功能覆蓋率達到 100%（基於 MDD 功能列表）
- 審核流程覆蓋率達到 100%（所有審核路徑）
- 簽核安全性測試覆蓋率達到 100%（權限和安全檢查）
- 缺陷發現率 > 95%（在系統測試前發現）

---

## 2. 測試功能點列表

### 2.1 核心功能點
基於 [`docs/mod/review_system_mdd.md`](../../mod/review_system_mdd.md) 中定義的功能需求：

| 功能ID | 功能名稱 | 功能描述 | 優先級 | 測試類型 |
|--------|---------|---------|--------|---------|
| F001 | 審核任務分派與管理 | 審核任務的分派和管理 | 高 | 功能測試 |
| F002 | 審核狀態追蹤 | 審核進度和狀態的追蹤 | 高 | 功能測試 |
| F003 | 審核期限管理 | 審核期限的設定和監控 | 中 | 功能測試 |
| F004 | 審核結果記錄 | 審核結果的記錄和保存 | 高 | 功能測試 |
| F005 | 文字意見註記 | 審核意見的文字註記 | 高 | 功能測試 |
| F006 | 標記和高亮 | 重點內容的標記和高亮 | 中 | 功能測試 |
| F007 | 附件和截圖 | 審核附件和截圖管理 | 中 | 功能測試 |
| F008 | 意見分類管理 | 審核意見的分類和管理 | 低 | 功能測試 |
| F009 | 資料一致性檢查 | 自動資料一致性檢查 | 高 | 功能測試 |
| F010 | 版本比較 | 不同版本間的比較 | 中 | 功能測試 |
| F011 | 異常值檢測 | 數據異常值的自動檢測 | 中 | 功能測試 |
| F012 | 自動化檢查規則 | 可配置的自動檢查規則 | 中 | 功能測試 |
| F013 | 數位簽核 | 數位簽核功能 | 高 | 安全測試 |
| F014 | 簽核權限驗證 | 簽核權限的驗證 | 高 | 安全測試 |
| F015 | 簽核記錄管理 | 簽核記錄的管理 | 高 | 功能測試 |
| F016 | 簽核狀態追蹤 | 簽核狀態的追蹤 | 中 | 功能測試 |

### 2.2 用戶故事對應
基於 [`docs/user_flows/core_user_flows.md`](../../user_flows/core_user_flows.md) 中相關的用戶故事：

| 用戶故事ID | 用戶故事描述 | 相關功能點 | 測試重點 |
|-----------|-------------|-----------|---------|
| US-003 | 審核人員審核報告 | F001, F002, F005, F009 | 審核流程、意見註記 |
| US-004 | 審核人員簽核發送 | F013, F014, F015 | 數位簽核、權限驗證 |

---

## 3. 測試環境與配置

### 3.1 測試環境要求
參考 [`docs/environment_configs/staging_env_sot.md`](../../environment_configs/staging_env_sot.md)：

**硬體需求**:
- CPU: 2 vCPU
- Memory: 4GB RAM
- Storage: 30GB SSD

**軟體需求**:
- 作業系統: Ubuntu 20.04 LTS
- 資料庫: PostgreSQL 13+
- 檔案存儲: MinIO 或 AWS S3
- 應用伺服器: Node.js 18+

### 3.2 測試配置
**環境配置**:
- 測試環境 URL: https://staging.hwayo.com
- 審核系統: 獨立服務實例
- 數位簽核: 測試用數位憑證

**測試帳號**:
| 角色 | 帳號 | 權限範圍 | 用途 |
|------|------|---------|------|
| 初級審核員 | junior_reviewer@hwayo.com | 基本審核權限 | 基本審核功能測試 |
| 高級審核員 | senior_reviewer@hwayo.com | 進階審核權限 | 複雜審核功能測試 |
| 簽核主管 | supervisor@hwayo.com | 簽核權限 | 簽核功能測試 |
| 品質經理 | quality_manager@hwayo.com | 全部審核權限 | 管理功能測試 |

---

## 4. 測試數據準備

### 4.1 基礎測試數據
**審核案例數據**:
- 正常檢驗案例: 符合標準的檢驗數據
- 異常檢驗案例: 包含錯誤或異常的數據
- 複雜檢驗案例: 需要多次審核的複雜案例

**審核意見數據**:
- 標準審核意見: 常見的審核意見模板
- 退回原因: 各種退回修改的原因
- 核准意見: 審核通過的標準意見

**簽核測試數據**:
- 數位憑證: 測試用的數位簽核憑證
- 簽核權限: 不同角色的簽核權限配置
- 簽核記錄: 歷史簽核記錄數據

### 4.2 測試數據管理
**數據準備方式**:
- 自動生成腳本: `scripts/test-data/review-test-data.sql`
- 測試憑證: `certs/test-signing-cert.p12`
- 數據重置方法: 每次測試前重置審核狀態

---

## 5. 測試案例

### 5.1 功能測試案例

#### 5.1.1 審核任務管理測試

**測試案例 TC-REVIEW-001**
- **測試標題**: 審核任務接收和分派
- **測試目標**: 驗證審核人員能正確接收和處理審核任務
- **前置條件**: 
  - 審核人員已登入系統
  - 存在待審核的檢驗案例
  - 任務分派規則已配置
- **測試步驟**:
  1. 審核人員登入審核系統
  2. 查看待審核任務列表
  3. 選擇並接收審核任務
  4. 檢查任務詳情和期限
  5. 開始審核流程
- **測試數據**: 微生物檢驗案例
- **預期結果**: 
  - 任務列表正確顯示待審核項目
  - 任務詳情完整準確
  - 審核期限正確計算
  - 任務狀態正確更新
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 核心功能，必須通過

**測試案例 TC-REVIEW-002**
- **測試標題**: 審核狀態追蹤測試
- **測試目標**: 驗證審核狀態的正確追蹤和更新
- **前置條件**: 
  - 審核任務已開始
  - 審核人員正在進行審核
- **測試步驟**:
  1. 開始審核任務
  2. 檢查狀態更新為 "進行中"
  3. 暫停審核任務
  4. 檢查狀態更新為 "暫停"
  5. 恢復並完成審核
  6. 檢查狀態更新為 "已完成"
- **測試數據**: 化學檢驗案例
- **預期結果**: 
  - 每個狀態變更都正確記錄
  - 狀態變更時間準確
  - 狀態歷史完整保存
  - 相關通知正確發送
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 狀態追蹤關鍵功能

#### 5.1.2 意見註記功能測試

**測試案例 TC-REVIEW-003**
- **測試標題**: 文字意見註記測試
- **測試目標**: 驗證審核人員能正確添加和管理文字意見
- **前置條件**: 
  - 審核任務已開始
  - 檢驗數據已載入
- **測試步驟**:
  1. 在檢驗數據特定欄位添加意見
  2. 輸入詳細的審核意見文字
  3. 設定意見類型（建議/問題/核准）
  4. 儲存意見註記
  5. 檢查意見顯示和格式
- **測試數據**: 包含多個數據欄位的檢驗案例
- **預期結果**: 
  - 意見正確關聯到對應欄位
  - 意見文字完整保存
  - 意見類型正確分類
  - 意見時間戳準確記錄
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 審核核心功能

**測試案例 TC-REVIEW-004**
- **測試標題**: 標記和高亮功能測試
- **測試目標**: 驗證重點內容的標記和高亮功能
- **前置條件**: 
  - 審核界面已載入
  - 檢驗數據可見
- **測試步驟**:
  1. 選擇需要標記的數據內容
  2. 應用不同顏色的高亮標記
  3. 添加標記說明
  4. 儲存標記設定
  5. 檢查標記顯示效果
- **測試數據**: 包含異常數值的檢驗數據
- **預期結果**: 
  - 高亮標記正確應用
  - 不同顏色正確區分
  - 標記說明正確顯示
  - 標記狀態正確保存
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 視覺化審核輔助功能

#### 5.1.3 差異檢查功能測試

**測試案例 TC-REVIEW-005**
- **測試標題**: 自動資料一致性檢查
- **測試目標**: 驗證系統能自動檢查資料一致性問題
- **前置條件**: 
  - 檢查規則已配置
  - 檢驗數據已載入
- **測試步驟**:
  1. 觸發自動一致性檢查
  2. 檢查數值範圍驗證
  3. 檢查必填欄位驗證
  4. 檢查邏輯關係驗證
  5. 查看檢查結果報告
- **測試數據**: 包含一致性問題的測試數據
- **預期結果**: 
  - 數值範圍問題被正確檢出
  - 必填欄位缺失被標記
  - 邏輯關係錯誤被識別
  - 檢查報告完整準確
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 自動化品質控制

**測試案例 TC-REVIEW-006**
- **測試標題**: 異常值檢測測試
- **測試目標**: 驗證系統能自動檢測數據異常值
- **前置條件**: 
  - 異常值檢測規則已配置
  - 歷史數據基準已建立
- **測試步驟**:
  1. 輸入包含異常值的檢驗數據
  2. 觸發異常值檢測
  3. 檢查統計異常檢測結果
  4. 檢查業務規則異常檢測
  5. 查看異常值報告
- **測試數據**: 包含統計異常和業務異常的數據
- **預期結果**: 
  - 統計異常值被正確識別
  - 業務規則異常被檢出
  - 異常程度正確評估
  - 異常報告詳細準確
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 智能品質控制

#### 5.1.4 數位簽核功能測試

**測試案例 TC-REVIEW-007**
- **測試標題**: 數位簽核功能測試
- **測試目標**: 驗證數位簽核功能的正確性和安全性
- **前置條件**: 
  - 簽核人員已登入
  - 審核已完成
  - 數位憑證已配置
- **測試步驟**:
  1. 簽核人員查看審核完成的報告
  2. 確認報告內容無誤
  3. 執行數位簽核操作
  4. 輸入簽核密碼或使用憑證
  5. 完成簽核並檢查簽核記錄
- **測試數據**: 已審核完成的檢驗報告
- **預期結果**: 
  - 簽核操作成功執行
  - 數位簽章正確生成
  - 簽核時間準確記錄
  - 簽核狀態正確更新
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 法律效力關鍵功能

**測試案例 TC-REVIEW-008**
- **測試標題**: 簽核權限驗證測試
- **測試目標**: 驗證簽核權限的正確驗證和控制
- **前置條件**: 
  - 不同權限級別的用戶存在
  - 簽核權限規則已配置
- **測試步驟**:
  1. 無簽核權限用戶嘗試簽核
  2. 檢查權限驗證結果
  3. 有權限用戶執行簽核
  4. 檢查權限驗證通過
  5. 驗證簽核記錄中的權限資訊
- **測試數據**: 不同權限級別的測試用戶
- **預期結果**: 
  - 無權限用戶被拒絕簽核
  - 權限錯誤訊息正確顯示
  - 有權限用戶成功簽核
  - 權限資訊正確記錄
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 安全控制關鍵功能

### 5.2 接口測試案例

#### 5.2.1 審核管理 API 測試

**測試案例 TC-REVIEW-API-001**
- **測試標題**: GET /api/review/tasks 獲取審核任務
- **測試目標**: 驗證審核任務獲取 API 的功能
- **API 端點**: GET /api/review/tasks?assignee=reviewer_test@hwayo.com&status=pending
- **請求參數**: 
  ```
  assignee: reviewer_test@hwayo.com
  status: pending
  ```
- **預期回應**: 
  ```json
  {
    "status": "success",
    "data": {
      "tasks": [
        {
          "taskId": "review_task_12345",
          "inspectionId": "inspection_12345",
          "assignee": "reviewer_test@hwayo.com",
          "status": "pending",
          "priority": "normal",
          "dueDate": "2025-06-02T10:00:00Z",
          "createdAt": "2025-05-31T10:00:00Z"
        }
      ],
      "total": 1
    }
  }
  ```
- **狀態碼**: 200
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

**測試案例 TC-REVIEW-API-002**
- **測試標題**: POST /api/review/comments 添加審核意見
- **測試目標**: 驗證審核意見添加 API 的功能
- **API 端點**: POST /api/review/comments
- **請求參數**: 
  ```json
  {
    "taskId": "review_task_12345",
    "fieldId": "temperature_reading",
    "commentType": "issue",
    "content": "溫度讀數似乎偏高，請確認測量條件",
    "severity": "medium"
  }
  ```
- **預期回應**: 
  ```json
  {
    "status": "success",
    "data": {
      "commentId": "comment_12345",
      "taskId": "review_task_12345",
      "createdAt": "2025-05-31T10:30:00Z",
      "createdBy": "reviewer_test@hwayo.com"
    }
  }
  ```
- **狀態碼**: 201
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

#### 5.2.2 簽核管理 API 測試

**測試案例 TC-REVIEW-API-003**
- **測試標題**: POST /api/review/sign 執行數位簽核
- **測試目標**: 驗證數位簽核 API 的功能
- **API 端點**: POST /api/review/sign
- **請求參數**: 
  ```json
  {
    "inspectionId": "inspection_12345",
    "signatureData": "base64_encoded_signature",
    "certificateId": "cert_12345",
    "comment": "審核完成，核准發送"
  }
  ```
- **預期回應**: 
  ```json
  {
    "status": "success",
    "data": {
      "signatureId": "signature_12345",
      "inspectionId": "inspection_12345",
      "signedAt": "2025-05-31T11:00:00Z",
      "signedBy": "supervisor@hwayo.com",
      "isValid": true
    }
  }
  ```
- **狀態碼**: 201
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

### 5.3 整合測試案例

#### 5.3.1 與工作流程引擎整合測試

**測試案例 TC-REVIEW-INT-001**
- **測試標題**: 審核結果觸發工作流程轉換
- **測試目標**: 驗證審核結果能正確觸發工作流程狀態轉換
- **測試場景**: 審核完成後觸發後續流程
- **測試步驟**:
  1. 審核人員完成審核並提交結果
  2. 審核系統觸發審核完成事件
  3. 工作流程引擎接收事件並更新狀態
  4. 檢查後續流程是否正確觸發
  5. 驗證相關通知是否發送
- **預期結果**: 
  - 審核完成事件正確觸發
  - 工作流程狀態正確轉換
  - 後續流程自動啟動
  - 相關人員收到通知
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

#### 5.3.2 與通知模組整合測試

**測試案例 TC-REVIEW-INT-002**
- **測試標題**: 審核通知發送整合
- **測試目標**: 驗證審核相關通知能正確發送
- **測試場景**: 審核過程中的各種通知
- **測試步驟**:
  1. 審核任務分派時發送通知
  2. 審核意見添加時發送通知
  3. 審核完成時發送通知
  4. 簽核完成時發送通知
  5. 檢查所有通知的接收情況
- **預期結果**: 
  - 所有相關通知正確發送
  - 通知內容準確完整
  - 通知接收者正確
  - 通知時間及時
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

---

## 6. 測試執行與缺陷管理

### 6.1 測試執行計劃
**執行順序**:
1. **單元測試**: 開發團隊執行審核邏輯測試
2. **功能測試**: QA 團隊執行審核功能測試
3. **接口測試**: 自動化執行 API 測試
4. **安全測試**: 專門的簽核安全測試
5. **整合測試**: QA + 開發團隊協作執行

**執行時程**:
| 測試階段 | 開始日期 | 結束日期 | 負責人 | 狀態 |
|---------|---------|---------|--------|------|
| 功能測試 | 待定 | 待定 | QA 團隊 | 待開始 |
| 接口測試 | 待定 | 待定 | 自動化測試 | 待開始 |
| 安全測試 | 待定 | 待定 | 安全團隊 | 待開始 |
| 整合測試 | 待定 | 待定 | QA + 開發 | 待開始 |

### 6.2 缺陷管理流程
**缺陷報告工具**: Jira
**缺陷分類標準**: 參考 [`docs/test-plan/overall_test_strategy.md`](../overall_test_strategy.md) 第 7.3 節

**缺陷優先級定義**:
- **P1 - 緊急**: 無法審核、簽核失敗、數據遺失
- **P2 - 高**: 意見註記錯誤、檢查規則失效
- **P3 - 中**: 界面異常、通知延遲
- **P4 - 低**: 介面美化、提示訊息優化

### 6.3 測試完成標準
**功能測試完成標準**:
- 所有 P1、P2 缺陷已修復並驗證
- 功能測試案例執行率 ≥ 95%
- 功能測試案例通過率 ≥ 90%

**安全測試完成標準**:
- 簽核安全性測試 100% 通過
- 權限控制測試無漏洞
- 數位簽章驗證正確

---

## 7. 自動化考量

### 7.1 自動化測試範圍
**適合自動化的測試**:
- 審核任務管理 API 測試 (100% 自動化)
- 資料一致性檢查測試 (90% 自動化)
- 異常值檢測測試 (85% 自動化)
- 回歸測試案例 (80% 自動化)

**不適合自動化的測試**:
- 複雜的人工審核判斷
- 視覺化標記和高亮測試
- 數位簽核的用戶體驗測試

### 7.2 自動化工具和框架
**測試框架**: Jest + Supertest
**API 測試工具**: Postman + Newman
**安全測試工具**: OWASP ZAP
**CI/CD 整合**: GitHub Actions

### 7.3 自動化測試維護
**維護策略**:
- 審核規則變更時更新測試腳本
- 定期更新測試憑證和權限配置
- 自動化測試結果集成到 CI/CD 流程

---

## 8. 風險與應對措施

### 8.1 測試風險識別
| 風險項目 | 風險等級 | 影響描述 | 應對措施 |
|---------|---------|---------|---------|
| 數位憑證過期 | 中 | 影響簽核功能測試 | 準備測試用長期憑證 |
| 審核規則複雜 | 中 | 測試案例設計困難 | 建立標準審核規則庫 |
| 權限配置錯誤 | 高 | 安全測試結果不準確 | 詳細記錄權限配置 |
| 大量審核數據 | 低 | 測試環境效能影響 | 使用精簡測試數據集 |

### 8.2 依賴性風險
**外部依賴**:
- 數位憑證服務: 簽核功能依賴
- 檔案存儲服務: 附件管理依賴

**內部依賴**:
- 工作流程引擎: 狀態轉換依賴
- 通知模組: 審核通知依賴

---

## 9. 測試報告與追蹤

### 9.1 測試進度追蹤
**追蹤指標**:
- 測試案例執行進度