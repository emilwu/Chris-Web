# 客戶入口模組功能測試計劃

## 文件資訊
- **模組名稱**: CustomerPortalModule (客戶入口模組)
- **文件版本**: v1.0
- **建立日期**: 2025/05/31
- **最後更新**: 2025/05/31
- **測試負責人**: QA 團隊
- **狀態**: 草稿
- **參考文件**: 
  - [`docs/mod/customer_portal_mdd.md`](../../mod/customer_portal_mdd.md) - 模組設計文件
  - [`docs/test-plan/overall_test_strategy.md`](../overall_test_strategy.md) - 總體測試策略
  - [`docs/user_flows/core_user_flows.md`](../../user_flows/core_user_flows.md) - 核心用戶流程
  - [`docs/mvp_definition.md`](../../mvp_definition.md) - MVP 定義

---

## 1. 引言

### 1.1 目的
本文件定義客戶入口模組的詳細功能測試計劃，確保：
- 安全連結存取機制可靠
- 報告下載功能穩定
- 歷史記錄查詢準確
- 狀態追蹤顯示完整
- 客戶資料管理安全

### 1.2 範圍
本測試計劃涵蓋：
- **存取控制測試**: 安全連結、身份認證、會話管理
- **報告管理測試**: 報告列表、詳情查看、下載功能
- **查詢功能測試**: 歷史查詢、狀態追蹤、搜尋篩選
- **安全性測試**: 權限控制、資料保護
- **整合測試**: 與通知、報告產生器的整合

### 1.3 測試目標
- 功能覆蓋率達到 100%（基於 MDD 功能列表）
- 安全性測試覆蓋率達到 100%（所有存取控制點）
- 用戶體驗測試覆蓋率達到 100%（所有客戶操作流程）
- 缺陷發現率 > 95%（在系統測試前發現）

---

## 2. 測試功能點列表

### 2.1 核心功能點
基於 [`docs/mod/customer_portal_mdd.md`](../../mod/customer_portal_mdd.md) 中定義的功能需求：

| 功能ID | 功能名稱 | 功能描述 | 優先級 | 測試類型 |
|--------|---------|---------|--------|---------|
| F001 | 安全連結生成與驗證 | 安全存取連結的生成和驗證 | 高 | 安全測試 |
| F002 | 客戶身份認證 | 客戶身份的認證機制 | 高 | 安全測試 |
| F003 | 會話管理 | 客戶會話的管理 | 高 | 功能測試 |
| F004 | 存取權限控制 | 客戶存取權限的控制 | 高 | 安全測試 |
| F005 | 報告列表顯示 | 客戶報告列表的顯示 | 高 | 功能測試 |
| F006 | 報告詳情查看 | 報告詳細資訊的查看 | 高 | 功能測試 |
| F007 | 報告下載功能 | 報告檔案的下載功能 | 高 | 功能測試 |
| F008 | 下載歷史記錄 | 下載歷史的記錄和顯示 | 中 | 功能測試 |
| F009 | 歷史報告查詢 | 歷史報告的查詢功能 | 中 | 功能測試 |
| F010 | 狀態追蹤查詢 | 檢驗狀態的追蹤查詢 | 中 | 功能測試 |
| F011 | 進度時間軸顯示 | 檢驗進度的時間軸顯示 | 中 | 功能測試 |
| F012 | 搜尋和篩選 | 報告的搜尋和篩選功能 | 低 | 功能測試 |

### 2.2 客戶操作流程測試
基於客戶使用場景的操作流程：

| 操作流程 | 流程描述 | 主要功能點 | 測試重點 |
|---------|---------|-----------|---------|
| 首次存取 | 客戶首次通過連結存取入口 | F001, F002, F003 | 安全性、易用性 |
| 報告查看 | 客戶查看可用報告列表 | F005, F006 | 資料準確性、介面友好性 |
| 報告下載 | 客戶下載檢驗報告 | F007, F008 | 下載穩定性、記錄完整性 |
| 歷史查詢 | 客戶查詢歷史檢驗記錄 | F009, F010, F011 | 查詢準確性、資訊完整性 |
| 狀態追蹤 | 客戶追蹤檢驗進度 | F010, F011 | 狀態準確性、更新及時性 |

### 2.3 用戶故事對應
基於 [`docs/user_flows/core_user_flows.md`](../../user_flows/core_user_flows.md) 中相關的用戶故事：

| 用戶故事ID | 用戶故事描述 | 相關功能點 | 測試重點 |
|-----------|-------------|-----------|---------|
| US-005 | 客戶報告接收 | F001, F005, F007 | 安全存取、報告下載 |

---

## 3. 測試環境與配置

### 3.1 測試環境要求
參考 [`docs/environment_configs/staging_env_sot.md`](../../environment_configs/staging_env_sot.md)：

**硬體需求**:
- CPU: 2 vCPU
- Memory: 4GB RAM
- Storage: 30GB SSD

**軟體需求**:
- 作業系統: Ubuntu 20.04 LTS
- Web 伺服器: Nginx
- 應用伺服器: Node.js 18+
- 資料庫: PostgreSQL 13+

### 3.2 測試配置
**環境配置**:
- 測試環境 URL: https://staging.hwayo.com
- 客戶入口 URL: https://staging.hwayo.com/portal
- SSL 憑證: 測試用 SSL 憑證

**測試帳號**:
| 客戶類型 | 公司名稱 | 聯絡人 | Email | 用途 |
|---------|---------|--------|-------|------|
| 一般客戶 | ABC 食品公司 | 張經理 | customer1@example.com | 基本功能測試 |
| VIP 客戶 | XYZ 製藥公司 | 李總監 | customer2@example.com | 進階功能測試 |
| 新客戶 | 123 生技公司 | 王主任 | customer3@example.com | 首次使用測試 |
| 測試客戶 | Test Company | Test User | test@example.com | 自動化測試 |

---

## 4. 測試數據準備

### 4.1 基礎測試數據
**客戶資料**:
- 客戶基本資訊: 公司名稱、聯絡人、Email、電話
- 客戶狀態: 活躍、非活躍、暫停
- 客戶權限: 不同等級的存取權限

**檢驗報告數據**:
- 已完成報告: 可下載的完整報告
- 進行中檢驗: 不同階段的檢驗案例
- 歷史報告: 過去 6 個月的報告記錄

**安全連結數據**:
- 有效連結: 未過期的安全存取連結
- 過期連結: 已過期的連結
- 無效連結: 格式錯誤或不存在的連結

### 4.2 測試數據管理
**數據準備方式**:
- 自動生成腳本: `scripts/test-data/customer-portal-test-data.sql`
- 測試報告檔案: `test-files/reports/` 目錄下的測試報告
- 數據重置方法: 每次測試前重置客戶會話狀態

---

## 5. 測試案例

### 5.1 功能測試案例

#### 5.1.1 安全存取功能測試

**測試案例 TC-PORTAL-001**
- **測試標題**: 安全連結存取測試
- **測試目標**: 驗證客戶能通過安全連結正確存取入口
- **前置條件**: 
  - 客戶已收到有效的安全存取連結
  - 客戶入口服務正常運行
- **測試步驟**:
  1. 客戶點擊 Email 中的安全連結
  2. 系統驗證連結的有效性
  3. 客戶被導向到入口登入頁面
  4. 客戶輸入基本驗證資訊
  5. 成功進入客戶入口主頁
- **測試數據**: 有效的安全存取連結
- **預期結果**: 
  - 連結驗證成功
  - 登入流程順暢
  - 成功進入客戶入口
  - 會話正確建立
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 核心安全功能

**測試案例 TC-PORTAL-002**
- **測試標題**: 過期連結處理測試
- **測試目標**: 驗證系統對過期連結的正確處理
- **前置條件**: 
  - 準備已過期的安全連結
  - 系統時間設定正確
- **測試步驟**:
  1. 客戶嘗試使用過期連結存取
  2. 系統檢測連結已過期
  3. 顯示連結過期錯誤訊息
  4. 提供聯絡客服的指引
  5. 記錄存取嘗試日誌
- **測試數據**: 過期的安全存取連結
- **預期結果**: 
  - 過期連結被正確識別
  - 顯示友好的錯誤訊息
  - 提供解決方案指引
  - 安全日誌正確記錄
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 安全控制機制

**測試案例 TC-PORTAL-003**
- **測試標題**: 會話管理測試
- **測試目標**: 驗證客戶會話的正確管理
- **前置條件**: 
  - 客戶已成功登入入口
  - 會話管理功能已啟用
- **測試步驟**:
  1. 客戶成功登入後開始會話
  2. 在會話期間進行正常操作
  3. 會話閒置超過設定時間
  4. 系統自動登出客戶
  5. 客戶嘗試繼續操作
- **測試數據**: 會話超時設定（如 30 分鐘）
- **預期結果**: 
  - 會話正確建立和維護
  - 超時後自動登出
  - 需要重新驗證才能繼續
  - 會話狀態正確清理
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 安全會話管理

#### 5.1.2 報告管理功能測試

**測試案例 TC-PORTAL-004**
- **測試標題**: 報告列表顯示測試
- **測試目標**: 驗證客戶能正確查看可用報告列表
- **前置條件**: 
  - 客戶已成功登入
  - 客戶有可用的檢驗報告
- **測試步驟**:
  1. 客戶進入報告列表頁面
  2. 系統載入客戶的報告列表
  3. 檢查報告資訊的完整性
  4. 驗證報告狀態的準確性
  5. 測試列表的排序和分頁功能
- **測試數據**: 客戶的多個檢驗報告
- **預期結果**: 
  - 報告列表正確顯示
  - 報告資訊完整準確
  - 狀態顯示正確
  - 排序和分頁功能正常
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 核心展示功能

**測試案例 TC-PORTAL-005**
- **測試標題**: 報告詳情查看測試
- **測試目標**: 驗證客戶能查看報告的詳細資訊
- **前置條件**: 
  - 客戶已在報告列表頁面
  - 存在可查看的報告
- **測試步驟**:
  1. 客戶點擊報告項目查看詳情
  2. 系統載入報告詳細資訊
  3. 檢查報告基本資訊顯示
  4. 驗證檢驗項目和結果顯示
  5. 確認報告狀態和時間資訊
- **測試數據**: 完整的檢驗報告詳情
- **預期結果**: 
  - 報告詳情正確載入
  - 所有資訊完整顯示
  - 格式清晰易讀
  - 狀態資訊準確
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 資訊展示功能

**測試案例 TC-PORTAL-006**
- **測試標題**: 報告下載功能測試
- **測試目標**: 驗證客戶能成功下載檢驗報告
- **前置條件**: 
  - 客戶已查看報告詳情
  - 報告檔案已生成完成
- **測試步驟**:
  1. 客戶點擊下載報告按鈕
  2. 系統驗證下載權限
  3. 開始檔案下載流程
  4. 檢查下載檔案的完整性
  5. 記錄下載歷史
- **測試數據**: 可下載的 PDF 報告檔案
- **預期結果**: 
  - 下載權限驗證正確
  - 檔案下載成功
  - 檔案內容完整無損
  - 下載記錄正確保存
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 核心服務功能

#### 5.1.3 查詢功能測試

**測試案例 TC-PORTAL-007**
- **測試標題**: 歷史報告查詢測試
- **測試目標**: 驗證客戶能查詢歷史檢驗報告
- **前置條件**: 
  - 客戶有歷史檢驗記錄
  - 查詢功能已啟用
- **測試步驟**:
  1. 客戶進入歷史查詢頁面
  2. 設定查詢條件（日期範圍、檢驗類型）
  3. 執行查詢操作
  4. 檢查查詢結果的準確性
  5. 測試結果的排序和篩選
- **測試數據**: 過去 6 個月的檢驗記錄
- **預期結果**: 
  - 查詢條件設定正確
  - 查詢結果準確
  - 排序篩選功能正常
  - 查詢效能良好
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 歷史資料查詢

**測試案例 TC-PORTAL-008**
- **測試標題**: 狀態追蹤功能測試
- **測試目標**: 驗證客戶能追蹤檢驗進度狀態
- **前置條件**: 
  - 客戶有進行中的檢驗案例
  - 狀態追蹤功能已配置
- **測試步驟**:
  1. 客戶選擇要追蹤的檢驗案例
  2. 系統顯示檢驗進度時間軸
  3. 檢查各階段狀態的準確性
  4. 驗證預計完成時間顯示
  5. 測試狀態更新的即時性
- **測試數據**: 不同階段的檢驗案例
- **預期結果**: 
  - 進度時間軸正確顯示
  - 狀態資訊準確
  - 預計時間合理
  - 狀態更新及時
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 進度追蹤功能

#### 5.1.4 搜尋篩選功能測試

**測試案例 TC-PORTAL-009**
- **測試標題**: 報告搜尋功能測試
- **測試目標**: 驗證客戶能搜尋特定的檢驗報告
- **前置條件**: 
  - 客戶有多個檢驗報告
  - 搜尋功能已實現
- **測試步驟**:
  1. 客戶在搜尋框輸入關鍵字
  2. 系統執行搜尋操作
  3. 顯示搜尋結果列表
  4. 測試不同搜尋條件
  5. 驗證搜尋結果的相關性
- **測試數據**: 包含不同關鍵字的報告
- **預期結果**: 
  - 搜尋功能響應迅速
  - 搜尋結果相關性高
  - 支援模糊搜尋
  - 無結果時顯示友好提示
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 搜尋便利性功能

### 5.2 接口測試案例

#### 5.2.1 客戶認證 API 測試

**測試案例 TC-PORTAL-API-001**
- **測試標題**: POST /api/portal/auth 客戶認證
- **測試目標**: 驗證客戶認證 API 的功能
- **API 端點**: POST /api/portal/auth
- **請求參數**: 
  ```json
  {
    "accessToken": "secure_access_token_12345",
    "customerEmail": "customer1@example.com",
    "verificationCode": "123456"
  }
  ```
- **預期回應**: 
  ```json
  {
    "status": "success",
    "data": {
      "sessionId": "session_12345",
      "customer": {
        "id": "customer_12345",
        "companyName": "ABC 食品公司",
        "contactName": "張經理"
      },
      "expiresIn": 1800
    }
  }
  ```
- **狀態碼**: 200
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

**測試案例 TC-PORTAL-API-002**
- **測試標題**: GET /api/portal/reports 報告列表獲取
- **測試目標**: 驗證報告列表獲取 API
- **API 端點**: GET /api/portal/reports?page=1&limit=10&status=completed
- **請求參數**: 
  ```
  page: 1
  limit: 10
  status: completed
  ```
- **預期回應**: 
  ```json
  {
    "status": "success",
    "data": {
      "reports": [
        {
          "reportId": "report_12345",
          "inspectionId": "inspection_12345",
          "inspectionType": "microbiology",
          "status": "completed",
          "completedAt": "2025-05-30T10:00:00Z",
          "downloadUrl": "/api/portal/reports/report_12345/download"
        }
      ],
      "pagination": {
        "page": 1,
        "limit": 10,
        "total": 25,
        "totalPages": 3
      }
    }
  }
  ```
- **狀態碼**: 200
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

#### 5.2.2 報告下載 API 測試

**測試案例 TC-PORTAL-API-003**
- **測試標題**: GET /api/portal/reports/download 報告下載
- **測試目標**: 驗證報告下載 API 的功能
- **API 端點**: GET /api/portal/reports/{reportId}/download
- **請求參數**: 
  ```
  reportId: report_12345
  Authorization: Bearer session_token
  ```
- **預期回應**: 
  ```
  Content-Type: application/pdf
  Content-Disposition: attachment; filename="inspection_report_12345.pdf"
  Content-Length: 2048576
  [PDF binary data]
  ```
- **狀態碼**: 200
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

### 5.3 整合測試案例

#### 5.3.1 與通知模組整合測試

**測試案例 TC-PORTAL-INT-001**
- **測試標題**: 報告完成通知到客戶存取
- **測試目標**: 驗證從報告完成通知到客戶存取的完整流程
- **測試場景**: 客戶收到報告完成通知後存取入口下載
- **測試步驟**:
  1. 報告生成完成觸發客戶通知
  2. 客戶收到包含安全連結的 Email
  3. 客戶點擊連結存取客戶入口
  4. 客戶查看新報告並下載
  5. 驗證整個流程的順暢性
- **預期結果**: 
  - 通知及時發送
  - 安全連結有效
  - 新報告正確顯示
  - 下載功能正常
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

#### 5.3.2 與報告產生器整合測試

**測試案例 TC-PORTAL-INT-002**
- **測試標題**: 報告生成到客戶可見性
- **測試目標**: 驗證報告生成完成後在客戶入口的可見性
- **測試場景**: 報告生成完成後客戶能立即在入口中看到
- **測試步驟**:
  1. 報告產生器完成報告生成
  2. 報告狀態更新為可下載
  3. 客戶入口同步更新報告狀態
  4. 客戶登入後能看到新報告
  5. 驗證報告資訊的一致性
- **預期結果**: 
  - 報告狀態同步及時
  - 客戶入口正確顯示新報告
  - 報告資訊完整一致
  - 下載連結有效
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

---

## 6. 測試執行與缺陷管理

### 6.1 測試執行計劃
**執行順序**:
1. **單元測試**: 開發團隊執行客戶入口邏輯測試
2. **功能測試**: QA 團隊執行客戶入口功能測試
3. **接口測試**: 自動化執行 API 測試
4. **安全測試**: 專門的安全性測試
5. **整合測試**: QA + 開發團隊協作執行

**執行時程**:
| 測試階段 | 開始日期 | 結束日期 | 負責人 | 狀態 |
|---------|---------|---------|--------|------|
| 功能測試 | 待定 | 待定 | QA 團隊 | 待開始 |
| 接口測試 | 待定 | 待定 | 自動化測試 | 待開始 |
| 安全測試 | 待定 | 待定 | 安全團隊 | 待開始 |
| 整合測試 | 待定 | 待定 | QA + 開發 | 待開始 |

### 6.2 缺陷管理流程
**缺陷報告工具**: Jira
**缺陷分類標準**: 參考 [`docs/test-plan/overall_test_strategy.md`](../overall_test_strategy.md) 第 7.3 節

**缺陷優先級定義**:
- **P1 - 緊急**: 無法存取入口、安全漏洞、無法下載報告
- **P2 - 高**: 認證失敗、報告顯示錯誤、下載異常
- **P3 - 中**: 查詢功能異常、介面問題
- **P4 - 低**: 介面美化、提示訊息優化

### 6.3 測試完成標準
**功能測試完成標準**:
- 所有 P1、P2 缺陷已修復並驗證
- 功能測試案例執行率 ≥ 95%
- 功能測試案例通過率 ≥ 90%

**安全測試完成標準**:
- 安全連結機制 100% 安全
- 客戶資料存取控制正確
- 無客戶資料洩露風險

---

## 7. 自動化考量

### 7.1 自動化測試範圍
**適合自動化的測試**:
- 客戶認證 API 測試 (100% 自動化)
- 報告列表和下載 API 測試 (100% 自動化)
- 安全連結驗證測試 (90% 自動化)
- 回歸測試案例 (85% 自動化)

**不適合自動化的測試**:
- 複雜的用戶體驗測試
- 客戶滿意度評估
- 視覺設計驗證

### 7.2 自動化工具和框架
**測試框架**: Jest + Supertest
**API 測試工具**: Postman + Newman
**安全測試工具**: OWASP ZAP
**CI/CD 整合**: GitHub Actions

### 7.3 自動化測試維護
**維護策略**:
- 客戶入口功能變更時更新測試腳本
- 定期更新測試客戶資料
- 自動化測試結果集成到 CI/CD 流程

---

## 8. 風險與應對措施

### 8.1 測試風險識別
| 風險項目 | 風險等