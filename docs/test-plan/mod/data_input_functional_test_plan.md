# 數據輸入模組功能測試計劃

## 文件資訊
- **模組名稱**: DataInputModule (實驗數據輸入介面模組)
- **文件版本**: v1.0
- **建立日期**: 2025/05/31
- **最後更新**: 2025/05/31
- **測試負責人**: QA 團隊
- **狀態**: 草稿
- **參考文件**: 
  - [`docs/mod/data_input_mdd.md`](../../mod/data_input_mdd.md) - 模組設計文件
  - [`docs/test-plan/overall_test_strategy.md`](../overall_test_strategy.md) - 總體測試策略
  - [`docs/user_flows/core_user_flows.md`](../../user_flows/core_user_flows.md) - 核心用戶流程
  - [`docs/mvp_definition.md`](../../mvp_definition.md) - MVP 定義

---

## 1. 引言

### 1.1 目的
本文件定義實驗數據輸入介面模組的詳細功能測試計劃，確保：
- 動態表單系統正確運作
- 多種資料類型輸入功能完整
- 資料驗證機制有效
- 檔案上傳功能穩定
- 草稿儲存機制可靠

### 1.2 範圍
本測試計劃涵蓋：
- **表單管理測試**: 動態表單配置、樣板管理
- **資料輸入測試**: 多類型資料輸入、格式驗證
- **檔案處理測試**: 檔案上傳、預覽、格式檢查
- **資料管理測試**: 草稿儲存、版本追蹤
- **整合測試**: 與認證、工作流程模組的整合

### 1.3 測試目標
- 功能覆蓋率達到 100%（基於 MDD 功能列表）
- 資料驗證覆蓋率達到 100%（所有輸入類型）
- 檔案上傳測試覆蓋率達到 100%（支援的檔案格式）
- 缺陷發現率 > 95%（在系統測試前發現）

---

## 2. 測試功能點列表

### 2.1 核心功能點
基於 [`docs/mod/data_input_mdd.md`](../../mod/data_input_mdd.md) 中定義的功能需求：

| 功能ID | 功能名稱 | 功能描述 | 優先級 | 測試類型 |
|--------|---------|---------|--------|---------|
| F001 | 動態表單配置 | 根據檢驗類型生成對應表單 | 高 | 功能測試 |
| F002 | 表單樣板管理 | 表單樣板的創建和管理 | 中 | 功能測試 |
| F003 | 欄位類型定義 | 支援多種資料輸入類型 | 高 | 功能測試 |
| F004 | 表單版本控制 | 表單配置的版本管理 | 中 | 功能測試 |
| F005 | 多類型資料輸入 | 文字、數值、日期等輸入 | 高 | 功能測試 |
| F006 | 檔案上傳處理 | 檔案上傳、預覽、驗證 | 高 | 功能測試 |
| F007 | 資料格式驗證 | 即時和提交時資料驗證 | 高 | 功能測試 |
| F008 | 自動儲存機制 | 草稿自動儲存功能 | 中 | 功能測試 |
| F009 | 草稿管理 | 草稿的儲存、載入、刪除 | 中 | 功能測試 |
| F010 | 資料預覽 | 輸入資料的預覽功能 | 低 | 功能測試 |
| F011 | 資料匯出 | 資料匯出為不同格式 | 低 | 功能測試 |
| F012 | 歷史版本追蹤 | 資料修改歷史記錄 | 中 | 功能測試 |

### 2.2 用戶故事對應
基於 [`docs/user_flows/core_user_flows.md`](../../user_flows/core_user_flows.md) 中相關的用戶故事：

| 用戶故事ID | 用戶故事描述 | 相關功能點 | 測試重點 |
|-----------|-------------|-----------|---------|
| US-001 | 研究員輸入實驗數據 | F001, F005, F007, F008 | 表單載入、資料輸入、驗證 |
| US-002 | 研究員提交檢驗報告 | F006, F009, F010 | 檔案上傳、草稿管理、預覽 |

---

## 3. 測試環境與配置

### 3.1 測試環境要求
參考 [`docs/environment_configs/staging_env_sot.md`](../../environment_configs/staging_env_sot.md)：

**硬體需求**:
- CPU: 2 vCPU
- Memory: 4GB RAM
- Storage: 50GB SSD (檔案上傳需求)

**軟體需求**:
- 作業系統: Ubuntu 20.04 LTS
- 資料庫: PostgreSQL 13+
- 檔案存儲: MinIO 或 AWS S3
- 應用伺服器: Node.js 18+

### 3.2 測試配置
**環境配置**:
- 測試環境 URL: https://staging.hwayo.com
- 檔案上傳限制: 50MB per file, 200MB total
- 支援檔案格式: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG

**測試帳號**:
| 角色 | 帳號 | 權限範圍 | 用途 |
|------|------|---------|------|
| 研究員 | researcher_test@hwayo.com | 數據輸入權限 | 基本輸入功能測試 |
| 高級研究員 | senior_researcher@hwayo.com | 進階輸入權限 | 複雜表單測試 |

---

## 4. 測試數據準備

### 4.1 基礎測試數據
**正常測試數據**:
- 文字資料: 標準實驗描述、樣本名稱
- 數值資料: 測量值、濃度、溫度等
- 日期資料: 實驗日期、到期日期
- 檔案資料: 各種格式的測試檔案

**邊界測試數據**:
- 最小文字長度: 1 字符
- 最大文字長度: 1000 字符
- 數值範圍: 0.001 ~ 999999.999
- 檔案大小: 1KB ~ 50MB

**異常測試數據**:
- 無效格式: 特殊字符、HTML 標籤
- 超出範圍: 負數、過大數值
- 惡意檔案: 病毒檔案、可執行檔案
- 損壞檔案: 不完整或損壞的檔案

### 4.2 測試數據管理
**數據準備方式**:
- 自動生成腳本: `scripts/test-data/input-test-data.sql`
- 測試檔案庫: `test-files/` 目錄下的各種測試檔案
- 數據重置方法: 每次測試前清理草稿和臨時檔案

---

## 5. 測試案例

### 5.1 功能測試案例

#### 5.1.1 動態表單功能測試

**測試案例 TC-INPUT-001**
- **測試標題**: 動態表單載入測試
- **測試目標**: 驗證系統能根據檢驗類型載入對應表單
- **前置條件**: 
  - 用戶已登入系統
  - 系統中存在多種檢驗類型配置
- **測試步驟**:
  1. 進入數據輸入頁面
  2. 選擇檢驗類型 "微生物檢驗"
  3. 觀察表單欄位載入情況
  4. 切換到 "化學檢驗" 類型
  5. 觀察表單欄位變化
- **測試數據**: 微生物檢驗、化學檢驗表單配置
- **預期結果**: 
  - 不同檢驗類型載入對應的表單欄位
  - 表單切換流暢，無錯誤
  - 欄位類型和驗證規則正確
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 核心功能，必須通過

**測試案例 TC-INPUT-002**
- **測試標題**: 表單欄位驗證測試
- **測試目標**: 驗證各種欄位類型的驗證規則
- **前置條件**: 
  - 表單已正確載入
  - 包含各種類型的欄位
- **測試步驟**:
  1. 在必填文字欄位留空並嘗試提交
  2. 在數值欄位輸入非數字內容
  3. 在日期欄位輸入無效日期格式
  4. 在 Email 欄位輸入無效 Email 格式
- **測試數據**: 各種無效輸入格式
- **預期結果**: 
  - 必填欄位顯示錯誤提示
  - 格式錯誤顯示相應錯誤訊息
  - 表單無法提交直到錯誤修正
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 資料品質關鍵功能

#### 5.1.2 資料輸入功能測試

**測試案例 TC-INPUT-003**
- **測試標題**: 多類型資料輸入測試
- **測試目標**: 驗證各種資料類型能正確輸入和儲存
- **前置條件**: 
  - 表單已載入完成
  - 包含各種資料類型欄位
- **測試步驟**:
  1. 輸入文字資料到文字欄位
  2. 輸入數值資料到數值欄位
  3. 選擇日期到日期欄位
  4. 從下拉選單選擇選項
  5. 在多行文字欄位輸入長文字
  6. 儲存表單
- **測試數據**: 各種有效的測試資料
- **預期結果**: 
  - 所有資料類型正確輸入
  - 資料格式正確保存
  - 儲存成功提示顯示
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 基本輸入功能

#### 5.1.3 檔案上傳功能測試

**測試案例 TC-INPUT-004**
- **測試標題**: 有效檔案上傳測試
- **測試目標**: 驗證支援格式的檔案能正確上傳
- **前置條件**: 
  - 表單包含檔案上傳欄位
  - 準備各種格式的測試檔案
- **測試步驟**:
  1. 上傳 PDF 檔案
  2. 上傳 Excel 檔案
  3. 上傳圖片檔案
  4. 檢查檔案預覽功能
  5. 提交表單
- **測試數據**: test.pdf, test.xlsx, test.jpg (各 5MB)
- **預期結果**: 
  - 檔案上傳成功
  - 檔案預覽正常顯示
  - 檔案資訊正確記錄
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 重要功能，影響用戶體驗

**測試案例 TC-INPUT-005**
- **測試標題**: 無效檔案上傳測試
- **測試目標**: 驗證系統對無效檔案的處理
- **前置條件**: 
  - 表單包含檔案上傳欄位
  - 準備無效檔案
- **測試步驟**:
  1. 嘗試上傳不支援格式檔案 (.exe)
  2. 嘗試上傳超大檔案 (100MB)
  3. 嘗試上傳損壞檔案
  4. 觀察錯誤處理
- **測試數據**: test.exe, large_file.pdf (100MB), corrupted.pdf
- **預期結果**: 
  - 不支援格式被拒絕並顯示錯誤
  - 超大檔案被拒絕並顯示大小限制
  - 損壞檔案被檢測並拒絕
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 安全性和穩定性關鍵

#### 5.1.4 草稿儲存功能測試

**測試案例 TC-INPUT-006**
- **測試標題**: 自動草稿儲存測試
- **測試目標**: 驗證系統能自動儲存用戶輸入的草稿
- **前置條件**: 
  - 用戶已開始填寫表單
  - 自動儲存功能已啟用
- **測試步驟**:
  1. 開始填寫表單資料
  2. 等待自動儲存觸發 (30秒)
  3. 重新整理頁面
  4. 檢查資料是否保留
  5. 繼續編輯並手動儲存草稿
- **測試數據**: 部分填寫的表單資料
- **預期結果**: 
  - 自動儲存功能正常運作
  - 頁面重新整理後資料保留
  - 手動儲存功能正常
  - 草稿狀態正確顯示
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]
- **備註**: 用戶體驗重要功能

### 5.2 接口測試案例

#### 5.2.1 表單配置 API 測試

**測試案例 TC-INPUT-API-001**
- **測試標題**: GET /api/forms/config 表單配置獲取
- **測試目標**: 驗證表單配置 API 的正常功能
- **API 端點**: GET /api/forms/config?type=microbiology
- **請求參數**: 
  ```
  type: microbiology
  ```
- **預期回應**: 
  ```json
  {
    "status": "success",
    "data": {
      "formId": "microbiology_v1",
      "title": "微生物檢驗表單",
      "fields": [
        {
          "id": "sample_name",
          "type": "text",
          "label": "樣本名稱",
          "required": true,
          "validation": {
            "minLength": 1,
            "maxLength": 100
          }
        }
      ]
    }
  }
  ```
- **狀態碼**: 200
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

#### 5.2.2 資料提交 API 測試

**測試案例 TC-INPUT-API-002**
- **測試標題**: POST /api/data/submit 資料提交
- **測試目標**: 驗證資料提交 API 的功能
- **API 端點**: POST /api/data/submit
- **請求參數**: 
  ```json
  {
    "formId": "microbiology_v1",
    "data": {
      "sample_name": "測試樣本001",
      "test_date": "2025-05-31",
      "temperature": 25.5
    },
    "files": ["file_id_1", "file_id_2"]
  }
  ```
- **預期回應**: 
  ```json
  {
    "status": "success",
    "data": {
      "submissionId": "sub_12345",
      "status": "submitted",
      "timestamp": "2025-05-31T10:00:00Z"
    }
  }
  ```
- **狀態碼**: 201
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

#### 5.2.3 檔案上傳 API 測試

**測試案例 TC-INPUT-API-003**
- **測試標題**: POST /api/files/upload 檔案上傳
- **測試目標**: 驗證檔案上傳 API 的功能
- **API 端點**: POST /api/files/upload
- **請求參數**: 
  ```
  Content-Type: multipart/form-data
  file: [binary file data]
  ```
- **預期回應**: 
  ```json
  {
    "status": "success",
    "data": {
      "fileId": "file_12345",
      "filename": "test.pdf",
      "size": 1024000,
      "mimeType": "application/pdf",
      "url": "/files/file_12345"
    }
  }
  ```
- **狀態碼**: 201
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

### 5.3 整合測試案例

#### 5.3.1 與認證模組整合測試

**測試案例 TC-INPUT-INT-001**
- **測試標題**: 數據輸入權限驗證整合
- **測試目標**: 驗證只有授權用戶能進行數據輸入
- **測試場景**: 不同角色用戶的數據輸入權限
- **測試步驟**:
  1. 研究員用戶登入並訪問數據輸入頁面
  2. 客戶用戶嘗試訪問數據輸入頁面
  3. 未登入用戶嘗試訪問數據輸入頁面
  4. 驗證權限控制效果
- **預期結果**: 
  - 研究員能正常訪問和使用數據輸入功能
  - 客戶用戶被拒絕訪問，返回 403 錯誤
  - 未登入用戶被重定向到登入頁面
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

#### 5.3.2 與工作流程引擎整合測試

**測試案例 TC-INPUT-INT-002**
- **測試標題**: 數據提交觸發工作流程
- **測試目標**: 驗證數據提交後能正確觸發審核流程
- **測試場景**: 完整的數據輸入到審核流程
- **測試步驟**:
  1. 研究員填寫完整的實驗數據表單
  2. 上傳必要的檔案
  3. 提交表單
  4. 檢查工作流程狀態
  5. 驗證審核人員收到通知
- **預期結果**: 
  - 數據提交成功
  - 工作流程狀態更新為 "待審核"
  - 審核人員收到新任務通知
  - 數據在審核系統中可見
- **實際結果**: [執行時填寫]
- **測試狀態**: [Pass/Fail/Blocked/Skip]

---

## 6. 測試執行與缺陷管理

### 6.1 測試執行計劃
**執行順序**:
1. **單元測試**: 開發團隊執行表單驗證邏輯測試
2. **功能測試**: QA 團隊執行數據輸入功能測試
3. **接口測試**: 自動化執行 API 測試
4. **檔案上傳測試**: 專門的檔案處理測試
5. **整合測試**: QA + 開發團隊協作執行

**執行時程**:
| 測試階段 | 開始日期 | 結束日期 | 負責人 | 狀態 |
|---------|---------|---------|--------|------|
| 功能測試 | 待定 | 待定 | QA 團隊 | 待開始 |
| 接口測試 | 待定 | 待定 | 自動化測試 | 待開始 |
| 檔案測試 | 待定 | 待定 | QA 團隊 | 待開始 |
| 整合測試 | 待定 | 待定 | QA + 開發 | 待開始 |

### 6.2 缺陷管理流程
**缺陷報告工具**: Jira
**缺陷分類標準**: 參考 [`docs/test-plan/overall_test_strategy.md`](../overall_test_strategy.md) 第 7.3 節

**缺陷優先級定義**:
- **P1 - 緊急**: 無法輸入數據、資料遺失
- **P2 - 高**: 檔案上傳失敗、驗證錯誤
- **P3 - 中**: 草稿儲存問題、介面異常
- **P4 - 低**: 介面美化、提示訊息優化

### 6.3 測試完成標準
**功能測試完成標準**:
- 所有 P1、P2 缺陷已修復並驗證
- 功能測試案例執行率 ≥ 95%
- 功能測試案例通過率 ≥ 90%

**檔案處理完成標準**:
- 支援的檔案格式 100% 測試通過
- 檔案大小限制正確執行
- 無檔案安全漏洞

---

## 7. 自動化考量

### 7.1 自動化測試範圍
**適合自動化的測試**:
- 表單配置 API 測試 (100% 自動化)
- 資料驗證測試 (90% 自動化)
- 檔案上傳 API 測試 (80% 自動化)
- 回歸測試案例 (85% 自動化)

**不適合自動化的測試**:
- 複雜的檔案預覽測試
- 用戶介面互動測試
- 檔案損壞檢測測試

### 7.2 自動化工具和框架
**測試框架**: Jest + Supertest
**檔案測試工具**: Multer + File validation
**API 測試工具**: Postman + Newman
**CI/CD 整合**: GitHub Actions

### 7.3 自動化測試維護
**維護策略**:
- 表單配置變更時更新測試腳本
- 定期更新測試檔案庫
- 自動化測試結果集成到 CI/CD 流程

---

## 8. 風險與應對措施

### 8.1 測試風險識別
| 風險項目 | 風險等級 | 影響描述 | 應對措施 |
|---------|---------|---------|---------|
| 檔案上傳服務不穩定 | 中 | 影響檔案相關測試 | 準備本地檔案存儲備案 |
| 大檔案測試影響環境 | 中 | 測試環境存儲空間不足 | 定期清理測試檔案 |
| 表單配置複雜 | 中 | 測試案例設計困難 | 建立標準測試表單 |
| 資料驗證規則變更 | 低 | 測試案例需要更新 | 建立驗證規則文檔 |

### 8.2 依賴性風險
**外部依賴**:
- 檔案存儲服務: MinIO/S3 服務穩定性
- 資料庫服務: PostgreSQL 存儲空間

**內部依賴**:
- 認證模組: 用戶權限驗證依賴
- 工作流程引擎: 數據提交後流程觸發

---

## 9. 測試報告與追蹤

### 9.1 測試進度追蹤
**追蹤指標**:
- 測試案例執行進度: 已執行/總數
- 檔案格式測試覆蓋率: 已測試格式/支援格式
- 缺陷發現和修復進度: 開放/已修復

### 9.2 測試報告格式
**日報告**: 每日數據輸入功能測試執行狀況
**週報告**: 週度測試進度和檔案處理問題總結
**最終報告**: 數據輸入模組測試完成總結

---

## 10. 附錄

### 10.1 測試案例執行記錄表
| 案例ID | 執行日期 | 執行人 | 結果 | 備註 |
|--------|---------|--------|------|------|
| TC-INPUT-001 | 待執行 | 待分配 | 待執行 | 動態表單核心功能 |
| TC-INPUT-004 | 待執行 | 待分配 | 待執行 | 檔案上傳重要功能 |
| TC-INPUT-006 | 待執行 | 待分配 | 待執行 | 草稿儲存功能 |

### 10.2 缺陷追蹤記錄表
| 缺陷ID | 發現日期 | 嚴重性 | 狀態 | 修復日期 | 驗證結果 |
|--------|---------|--------|------|---------|---------|
| 待發現 | - | - | - | - | - |

### 10.3 測試環境配置清單
**環境檢查清單**:
- [ ] 測試環境可正常訪問
- [ ] 檔案上傳服務正常運行
- [ ] 資料庫連接正常
- [ ] 測試檔案庫準備完成
- [ ] 表單配置正確載入
- [ ] 檔案大小限制配置正確

---

## 文件版本歷史
| 版本 | 日期 | 修改內容 | 修改人 |
|------|------|---------|--------|
| v1.0 | 2025/05/31 | 初始版本建立 | Roo (Architect) |

## 審核和批准
| 角色 | 姓名 | 簽名 | 日期 |
|------|------|------|------|
| 測試負責人 | 待定 | 待簽名 | 待定 |
| QA 主管 | 待定 | 待簽名 | 待定 |
| 專案經理 | 待定 | 待簽名 | 待定 |